# 紧急包（Emergency Kit）

> 当一切都出错时，你需要的所有东西

## 📦 紧急包内容清单

### 1. 私钥和助记词备份

```
┌─────────────────────────────────────┐
│  钱包 1 - MetaMask（日常使用）       │
├─────────────────────────────────────┤
│  助记词: [12个单词]                  │
│  私钥: 0x...                         │
│  地址: 0x...                         │
│  存储位置: 密码管理器 + 纸质备份      │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  钱包 2 - Ledger（冷存储）           │
├─────────────────────────────────────┤
│  助记词: [24个单词]                  │
│  PIN: ****                           │
│  地址: 0x...                         │
│  存储位置: 金属板 + 保险箱            │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  钱包 3 - 纸钱包（备份）             │
├─────────────────────────────────────┤
│  助记词: [12个单词]                  │
│  私钥: 0x...                         │
│  地址: 0x...                         │
│  存储位置: 银行保险柜                │
└─────────────────────────────────────┘
```

**备份检查清单**:
- [ ] 助记词已写在纸上（用铅笔，不用圆珠笔）
- [ ] 助记词已刻在金属板上（防火防水）
- [ ] 私钥已加密存储在密码管理器
- [ ] 备份存放在至少 2 个不同的物理位置
- [ ] 已测试恢复流程（在测试网）

### 2. 合约地址和配置

创建文件：`emergency/contract_addresses.txt`

```
=== DIAP 合约地址（Sepolia 测试网）===

DIAPToken: 0x...
DIAPAgentNetwork: 0x...
DIAPPaymentCore: 0x...
DIAPPaymentChannel: 0x...
DIAPPaymentPrivacy: 0x...
DIAPGovernance: 0x...
DIAPVerification: 0x...

Gnosis Safe: 0x...

部署区块: #...
部署时间: 2024-10-31
部署者: 0x...

=== 重要交易哈希 ===

部署 Token: 0x...
转移所有权: 0x...
初始分配: 0x...

=== RPC URLs ===

Sepolia: https://sepolia.infura.io/v3/...
Mainnet: https://mainnet.infura.io/v3/...

=== Etherscan ===

Sepolia: https://sepolia.etherscan.io
Mainnet: https://etherscan.io

=== 最后更新 ===

日期: 2024-10-31
更新人: [你的名字]
```

### 3. 紧急脚本

#### 脚本 1: 快速暂停

创建文件：`emergency/QUICK_PAUSE.sh`

```bash
#!/bin/bash

echo "🚨 紧急暂停脚本"
echo "================="
echo ""
echo "⚠️  警告：此操作将暂停所有合约！"
echo ""
read -p "确认执行？(yes/no): " confirm

if [ "$confirm" != "yes" ]; then
    echo "已取消"
    exit 1
fi

echo ""
echo "开始暂停合约..."
echo ""

# 设置环境变量
export PRIVATE_KEY="你的私钥"
export DIAP_TOKEN_ADDRESS="0x..."
export DIAP_NETWORK_ADDRESS="0x..."

# 执行暂停
npx hardhat run scripts/emergency/pause_all.js --network sepolia

echo ""
echo "✅ 暂停完成"
echo ""
echo "下一步："
echo "1. 通知用户"
echo "2. 分析问题"
echo "3. 准备修复"
```

#### 脚本 2: 快速检查

创建文件：`emergency/QUICK_CHECK.sh`

```bash
#!/bin/bash

echo "🔍 快速健康检查"
echo "================="
echo ""

# 检查合约状态
npx hardhat run scripts/monitoring/health_check.js --network sepolia

echo ""
echo "检查完成"
```

#### 脚本 3: 紧急联系

创建文件：`emergency/EMERGENCY_CONTACTS.txt`

```
=== 紧急联系人 ===

你自己:
  电话: +86 ...
  Email: ...
  Telegram: @...

技术顾问（如果有）:
  姓名: ...
  电话: ...
  Email: ...
  专长: 智能合约安全

审计公司（如果有）:
  公司: ...
  联系人: ...
  电话: ...
  Email: ...

律师（如果有）:
  姓名: ...
  电话: ...
  Email: ...

=== 技术支持 ===

OpenZeppelin:
  Discord: https://discord.gg/openzeppelin
  Forum: https://forum.openzeppelin.com

Hardhat:
  Discord: https://discord.gg/hardhat
  GitHub: https://github.com/NomicFoundation/hardhat

Etherscan:
  Support: https://etherscan.io/contactus

=== 社区 ===

Discord: https://discord.gg/你的服务器
Telegram: https://t.me/你的群组
Twitter: https://twitter.com/你的账号
```

### 4. 操作手册

创建文件：`emergency/OPERATIONS_MANUAL.md`

```markdown
# 紧急操作手册

## 场景 1: 发现安全漏洞

### 立即行动（5分钟内）

1. **暂停合约**
   ```bash
   cd /path/to/project
   ./emergency/QUICK_PAUSE.sh
   ```

2. **通知用户**
   - 发 Discord 公告
   - 发 Telegram 消息
   - 发 Twitter 声明

3. **联系专家**
   - 打电话给技术顾问
   - 在 Discord 求助
   - 联系审计公司

### 后续行动（1小时内）

1. **分析问题**
   - 查看交易记录
   - 检查合约状态
   - 评估损失

2. **准备修复**
   - 修复代码
   - 测试修复
   - 准备升级

3. **沟通计划**
   - 准备详细公告
   - 说明补偿方案
   - 设定恢复时间

## 场景 2: 合约被攻击

### 立即行动（立即）

1. **暂停合约**（如果还能控制）

2. **记录证据**
   - 截图交易
   - 保存日志
   - 记录时间线

3. **评估损失**
   - 检查余额
   - 统计受影响用户
   - 计算损失金额

### 后续行动

1. **报警**（如果损失重大）
   - 联系当地警方
   - 准备证据材料

2. **追踪资金**
   - 使用 Etherscan
   - 联系交易所
   - 寻求社区帮助

3. **补偿用户**
   - 制定补偿方案
   - 执行补偿
   - 公开透明

## 场景 3: 私钥丢失

### 如果丢失 1 个钱包

1. **使用其他 2 个钱包**
   - 多签仍然可用（2/3）
   - 立即转移资金到新 Safe

2. **创建新钱包**
   - 生成新助记词
   - 备份新钱包

3. **更新 Safe**
   - 移除丢失的钱包
   - 添加新钱包

### 如果丢失 2 个钱包

1. **紧急恢复**
   - 使用最后一个钱包
   - 立即转移所有资金

2. **重新设置**
   - 创建新的 Safe
   - 转移合约所有权

## 场景 4: 服务器/电脑故障

### 备份位置

1. **代码备份**
   - GitHub（主要）
   - GitLab（镜像）
   - 本地硬盘

2. **配置备份**
   - .env 文件（加密存储）
   - 合约地址列表
   - 部署记录

3. **文档备份**
   - Google Drive
   - Dropbox
   - 本地硬盘

### 恢复步骤

1. **获取新设备**

2. **恢复代码**
   ```bash
   git clone https://github.com/你的仓库
   cd 项目目录
   npm install
   ```

3. **恢复配置**
   - 从备份恢复 .env
   - 验证合约地址

4. **测试功能**
   - 运行健康检查
   - 测试紧急脚本

## 场景 5: 你出事了（死人开关）

### 给家人/受托人的说明

**如果我 30 天没有联系，请按以下步骤操作：**

1. **找到这个文件夹**
   - 位置: [具体位置]
   - 密码: [如果加密]

2. **联系技术顾问**
   - 姓名: [顾问姓名]
   - 电话: [顾问电话]
   - 说明情况

3. **访问钱包**
   - 助记词在: [具体位置]
   - 按照技术顾问指导操作

4. **转移资金**
   - 技术顾问会帮助
   - 转移到安全地址

5. **通知社区**
   - 发布公告
   - 说明情况
   - 寻找接班人
```

### 5. 通信模板

创建文件：`emergency/COMMUNICATION_TEMPLATES.md`

```markdown
# 通信模板

## 模板 1: 发现问题（第一时间）

```
🚨 重要通知

我们发现了一个潜在的安全问题，正在紧急调查中。

当前状态：
- 合约已暂停
- 用户资金安全
- 团队正在处理

我们会在 1 小时内提供更新。

感谢您的耐心。

DIAP 团队
2024-10-31 14:30
```

## 模板 2: 问题更新（每小时）

```
📢 更新 #1

最新进展：
- 已确认问题原因
- 正在准备修复方案
- 预计 X 小时内恢复

受影响范围：
- [具体说明]

用户行动：
- 无需操作
- 资金安全
- 等待恢复

下次更新：1小时后

DIAP 团队
2024-10-31 15:30
```

## 模板 3: 问题解决（事后）

```
✅ 服务已恢复

问题已解决，服务已完全恢复。

事件总结：
- 问题: [简要说明]
- 原因: [根本原因]
- 影响: [影响范围]
- 解决: [解决方案]

补偿方案：
- [如果有]

改进措施：
- [防止再次发生]

感谢大家的支持和理解。

完整报告：[链接]

DIAP 团队
2024-10-31 18:00
```

## 模板 4: 紧急求助（社区）

```
🆘 紧急求助

我们遇到了 [问题描述]，需要社区帮助。

问题详情：
- [详细说明]
- 合约地址: 0x...
- 交易哈希: 0x...

如果您有相关经验，请联系：
- Discord: [链接]
- Telegram: [链接]
- Email: [邮箱]

非常感谢！

DIAP 团队
```
```

### 6. 检查清单

创建文件：`emergency/CHECKLIST.md`

```markdown
# 紧急包检查清单

## 每周检查

- [ ] 测试 Telegram Bot
- [ ] 运行健康检查
- [ ] 检查备份完整性
- [ ] 验证紧急脚本可用

## 每月检查

- [ ] 测试多签钱包
- [ ] 更新合约地址列表
- [ ] 检查所有备份位置
- [ ] 测试恢复流程
- [ ] 更新联系人信息

## 每季度检查

- [ ] 完整的灾难恢复演练
- [ ] 更新操作手册
- [ ] 审查安全措施
- [ ] 更新紧急联系人
- [ ] 检查保险箱内容

## 重大更新后

- [ ] 更新合约地址
- [ ] 更新部署记录
- [ ] 测试所有脚本
- [ ] 更新文档
- [ ] 通知相关人员
```

## 📍 存储位置建议

### 数字备份

```
1. 密码管理器（1Password/Bitwarden）
   - 私钥（加密）
   - API 密钥
   - 密码

2. 云存储（加密）
   - Google Drive
   - Dropbox
   - 文档和脚本

3. GitHub（私有仓库）
   - 代码
   - 脚本
   - 文档（不含私钥）
```

### 物理备份

```
1. 家中保险箱
   - 纸钱包助记词
   - Ledger 设备
   - 紧急联系人列表

2. 银行保险柜
   - 金属板助记词
   - 重要文档副本
   - 遗嘱

3. 信任的人处
   - 紧急包副本（不含私钥）
   - 联系方式
   - 操作说明
```

## 🔒 安全提示

1. **永远不要**
   - 在线存储未加密的私钥
   - 截图助记词
   - 通过邮件/消息发送私钥
   - 使用云同步存储私钥

2. **务必**
   - 使用强密码
   - 启用 2FA
   - 定期测试备份
   - 保持更新

3. **建议**
   - 使用硬件钱包
   - 使用金属板备份
   - 定期演练
   - 保持警惕

---

**最重要的**: 定期测试你的紧急包！

不要等到真正紧急时才发现备份不可用。

每月至少测试一次恢复流程。

🎯 目标：任何情况下都能在 1 小时内恢复控制！
